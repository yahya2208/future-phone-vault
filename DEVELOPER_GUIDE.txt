# دليل المطور - نظام إدارة المستخدمين والتراخيص

## جدول المحتويات
1. التحديثات الحديثة
2. الملفات الحساسة
3. آلية عمل النظام
4. نصائح وإرشادات
5. استكشاف الأخطاء وإصلاحها

## 1. التحديثات الحديثة

### 1.1 نظام الترخيص الجديد
- إضافة نظام ترخيص متكامل مع آلية تفعيل الأجهزة
- إضافة جداول قاعدة البيانات الخاصة بالتراخيص
- إضافة سياسات RLS للتحكم في الصلاحيات
- واجهة إدارة التراخيص في لوحة التحكم

### 1.2 تحسينات نظام المصادقة
- تحديث نظام المصادقة ليدعم تجربة مستخدم أفضل
- تحسين أمان الجلسات
- إضافة دعم للمصادقة المتعددة العوامل

### 1.3 واجهة المستخدم الإدارية
- إضافة لوحة تحكم إدارية متكاملة
- إدارة المستخدمين والتراخيص
- تقارير وإحصائيات متقدمة

## 2. الملفات الحساسة

### 2.1 ملفات المصادقة والأمان
- `src/integrations/supabase/client.ts`
  - يحتوي على إعدادات اتصال Supabase
  - يجب الحفاظ على سرية مفاتيح API

- `src/middleware.ts`
  - يتحكم في صلاحيات الوصول للطرق
  - التأكد من صحة التوكنات

- `src/utils/licenseManager.ts`
  - يدير عمليات الترخيص من جانب العميل
  - يتعامل مع تفعيل وجدولة التراخيص

### 2.2 ملفات قاعدة البيانات
- `supabase/migrations/`
  - تحتوي على جميع هجرات قاعدة البيانات
  - لا تقم بتعديل الملفات بعد نشرها

### 2.3 ملفات التكوين
- `.env` و `.env.example`
  - يحتويان على المتغيرات البيئية
  - التأكد من تحديث الملفين معًا

## 3. آلية عمل النظام

### 3.1 عملية التسجيل والمصادقة
1. المستخدم يقوم بالتسجيل عبر `src/pages/Auth.tsx`
2. يتم إنشاء ملف شخصي تلقائيًا عبر `supabase/functions/create-user-profile/index.ts`
3. يتم التحقق من البريد الإلكتروني
4. يتم تسجيل الدخول وإنشاء جلسة

### 3.2 إدارة الملفات الشخصية
- `src/pages/Profile.tsx`
  - واجهة عرض وتعديل الملف الشخصي
  - رفع وتعديل الصورة الشخصية

### 3.3 نظام الترخيص
1. التحقق من الترخيص عند كل طلب
2. تحديث حالة الترخيص بشكل دوري
3. تقييد الميزات حسب نوع الترخيص

## 4. نصائح وإرشادات

### 4.1 قبل الإصدار
- اختبار جميع سيناريوهات الترخيص
- التحقق من صحة جميع المتغيرات البيئية
- مراجعة سياسات الأمان والصلاحيات

### 4.2 أثناء التطوير
- استخدم فروع Git منفصلة للميزات الجديدة
- اكتب اختبارات وحدية للتغييرات الجديدة
- توثيق التغييرات في ملف CHANGELOG.md

### 4.3 للأمان
- لا تشارك المفاتيح السرية
- استخدم HTTPS لجميع الاتصالات
- حافظ على تحديث المكتبات

## 5. استكشاف الأخطاء وإصلاحها

### 5.1 مشاكل المصادقة
- التحقق من صحة مفاتيح API
- التأكد من إعدادات CORS
- مراجعة سجلات الأخطاء في وحدة تحكم المتصفح

### 5.2 مشاكل الترخيص
- التحقق من اتصال الخادم
- مراجعة سجلات قاعدة البيانات
- التأكد من صحة التوكنات

### 5.3 مشاكل الأداء
- مراقبة استهلاك الذاكرة
- تحسين استعلامات قاعدة البيانات
- استخدام التخزين المؤقت عند الحاجة

---
آخر تحديث: 2025-07-07

لأية استفسارات تقنية، يرجى الرجوع إلى الوثائق الرسمية أو التواصل مع فريق الدعم الفني.
